<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IELTS Writing Simulator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root {
    --primary:#c0392b;
    --secondary:#2c3e50;
    --light:#ecf0f1;
}
body{
    font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
    background:#e9ecef;
    margin:0;
    padding:20px;
    display:flex;
    justify-content:center;
}
.container{
    width:100%;
    max-width:1000px;
    background:#fff;
    border-radius:8px;
    box-shadow:0 4px 15px rgba(0,0,0,.1);
    display:flex;
    flex-direction:column;
}
.tabs{display:flex;background:var(--secondary);}
.tab-btn{
    flex:1;padding:15px;border:none;background:none;
    color:#bdc3c7;font-size:1.1rem;font-weight:bold;
    cursor:pointer;
}
.tab-btn.active{
    background:#fff;color:var(--secondary);
    border-top:4px solid var(--primary);
}
.tab-content{display:none;padding:20px;}
.tab-content.active{display:block;}
.controls{
    display:flex;gap:10px;margin-bottom:20px;
    background:#f8f9fa;padding:15px;border-radius:6px;
    align-items:center;justify-content:space-between;
}
select{padding:8px;border-radius:4px;border:1px solid #ced4da;flex:1}
.timer{font-family:monospace;font-size:1.8rem;font-weight:bold}
.timer.warning{color:#e74c3c;animation:pulse 1s infinite}
@keyframes pulse{50%{opacity:.5}}
.action-btn{
    background:var(--primary);color:#fff;
    border:none;padding:10px 20px;border-radius:4px;
    cursor:pointer;font-weight:bold;
}
textarea{
    width:100%;height:400px;padding:15px;
    border:1px solid #ced4da;border-radius:4px;
    font-family:'Times New Roman';font-size:1.1rem;
    resize:vertical;
}
.footer{display:flex;justify-content:space-between;margin-top:10px;color:#6c757d}
.prompt-image-container{display:none;text-align:center;margin-bottom:20px}
.prompt-image-container img{max-width:100%}
.result-area{display:none;text-align:center;margin-top:20px}
.fullscreen-btn{
    position:fixed;top:10px;right:10px;
    z-index:9999;background:#000;color:#fff;
    border:none;padding:8px 12px;border-radius:4px;
}
</style>
</head>

<body>

<button class="fullscreen-btn" onclick="requestFullscreen()">â›¶ Fullscreen</button>

<div class="container">
<div class="tabs">
<button class="tab-btn active" onclick="openTab('task1')">Task 1 (20 min)</button>
<button class="tab-btn" onclick="openTab('task2')">Task 2 (40 min)</button>
</div>

<!-- TASK 1 -->
<div id="task1" class="tab-content active">
<div class="controls">
<select id="t1-select" onchange="showImage(this.value)">
<option value="" disabled selected>Select Task 1 Prompt</option>
<option value="0">Bar Chart</option>
<option value="1">Line Graph</option>
<option value="2">Pie Chart</option>
<option value="3">Map</option>
<option value="4">Table</option>
</select>
<div id="t1-timer" class="timer">20:00</div>
<button id="t1-btn" class="action-btn" onclick="startTimer('t1',20)">Start</button>
</div>

<div id="t1-img-container" class="prompt-image-container">
<img id="t1-image">
</div>

<textarea id="t1-text" disabled></textarea>

<div class="footer">
<span id="t1-status">Status: Waiting</span>
<span>Words: <strong id="t1-words">0</strong></span>
</div>

<div id="t1-result" class="result-area">
<h3>Time is up!</h3>
<button onclick="takeScreenshot('t1')">Download Screenshot</button>
</div>
</div>

<!-- TASK 2 -->
<div id="task2" class="tab-content">
<div class="controls">
<select id="t2-select">
<option value="" disabled selected>Select Task 2 Prompt</option>
<option value="Topic 1">Education</option>
<option value="Topic 2">Environment</option>
<option value="Topic 3">Technology</option>
<option value="Topic 4">Crime</option>
<option value="Topic 5">Government</option>
</select>
<div id="t2-timer" class="timer">40:00</div>
<button id="t2-btn" class="action-btn" onclick="startTimer('t2',40)">Start</button>
</div>

<div id="t2-prompt-display" style="display:none;margin-bottom:10px"></div>

<textarea id="t2-text" disabled></textarea>

<div class="footer">
<span id="t2-status">Status: Waiting</span>
<span>Words: <strong id="t2-words">0</strong></span>
</div>

<div id="t2-result" class="result-area">
<h3>Time is up!</h3>
<button onclick="takeScreenshot('t2')">Download Screenshot</button>
</div>
</div>
</div>

<script>
/* FULLSCREEN */
function requestFullscreen(){
    const el=document.documentElement;
    if(el.requestFullscreen)el.requestFullscreen();
}

/* STORAGE */
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load=(k,d=null)=>localStorage.getItem(k)?JSON.parse(localStorage.getItem(k)):d;

/* PROMPTS */
const imageUrls=[
"https://github.com/khr824/wp/blob/f4fbae73ee6118905ce46eb9060beada2a16a45e/image%201.png?raw=true",
"https://github.com/khr824/wp/blob/f4fbae73ee6118905ce46eb9060beada2a16a45e/image%202.png?raw=true",
"https://github.com/khr824/wp/blob/f4fbae73ee6118905ce46eb9060beada2a16a45e/image%203.png?raw=true",
"https://github.com/khr824/wp/blob/f4fbae73ee6118905ce46eb9060beada2a16a45e/image%204.png?raw=true",
"https://github.com/khr824/wp/blob/f4fbae73ee6118905ce46eb9060beada2a16a45e/image%205.png?raw=true"
];

const task2Prompts={
"Topic 1":"University education should be free...",
"Topic 2":"Increase fuel prices to solve environmental issues...",
"Topic 3":"Advantages and disadvantages of remote work...",
"Topic 4":"Causes and solutions to youth crime...",
"Topic 5":"Arts vs public services funding..."
};

let timers={};

/* TABS */
function openTab(id){
document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
document.getElementById(id).classList.add('active');
}

/* IMAGE */
function showImage(i){
document.getElementById('t1-image').src=imageUrls[i];
document.getElementById('t1-img-container').style.display='block';
}

/* TIMER */
function startTimer(id,min){
const select=document.getElementById(id+'-select');
if(!select.value)return alert("Select a prompt first");
lockUI(id);
let time=load(id+'-time',min*60);
save(id+'-running',true);
runTimer(id,time);
}

function runTimer(id,time){
const display=document.getElementById(id+'-timer');
timers[id]=setInterval(()=>{
let m=Math.floor(time/60);
let s=time%60;
display.textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
save(id+'-time',time);
if(time<=0)endTask(id);
time--;
},1000);
}

function endTask(id){
clearInterval(timers[id]);
save(id+'-running',false);
document.getElementById(id+'-text').disabled=true;
document.getElementById(id+'-result').style.display='block';
}

/* UI */
function lockUI(id){
document.getElementById(id+'-text').disabled=false;
document.getElementById(id+'-btn').disabled=true;
document.getElementById(id+'-select').disabled=true;
}

/* WORD COUNT + SAVE */
['t1','t2'].forEach(id=>{
const area=document.getElementById(id+'-text');
area.value=load(id+'-text','');
area.addEventListener('input',()=>{
save(id+'-text',area.value);
document.getElementById(id+'-words').textContent=
area.value.trim().split(/\s+/).filter(Boolean).length;
});
});

/* RESTORE */
window.onload=()=>{
requestFullscreen();
['t1','t2'].forEach((id,i)=>{
if(load(id+'-running')){
lockUI(id);
runTimer(id,load(id+'-time'));
}
});
};

/* SCREENSHOT */
function takeScreenshot(id){
html2canvas(document.getElementById(id)).then(c=>{
const a=document.createElement('a');
a.href=c.toDataURL();
a.download=id+'.png';
a.click();
});
}
</script>

</body>
</html>
